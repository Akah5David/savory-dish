import t from"debug";import e from"util";class r{_options;constructor(t){this._options=t,this.preflightValidation()}}class n extends Error{constructor(t=void 0,e="An error occurred in the Strapi client. Please check the logs for more information."){super(e),this.cause=t}}class o extends n{constructor(t=void 0,e="Some of the provided values are not valid."){super(t,e)}}class i extends n{constructor(t=void 0,e="Could not initialize the Strapi Client"){super(t,e)}}class a extends Error{}class s extends a{constructor(t){super(`Could not parse invalid URL: "${t}"`)}}class u extends Error{name="HTTPError";response;request;constructor(t,e){const r=`${t.status?.toString()??""} ${t.statusText??""}`.trim();super(`Request failed with ${r?`status code ${r}`:"an unknown error"}: ${e.method} ${e.url}`),this.response=t,this.request=e}}class c extends u{name="HTTPAuthorizationError"}class l extends u{name="HTTPNotFoundError"}class p extends u{name="HTTPBadRequestError"}class f extends u{name="HTTPInternalServerError"}class y extends u{name="HTTPForbiddenError"}class d extends u{name="HTTPTimeoutError"}const h=t("strapi:auth:provider:api-token");class g extends r{static identifier="api-token";constructor(t){super(t)}get name(){return g.identifier}get _token(){return this._options.token}preflightValidation(){if(h("validating provider configuration"),"string"!=typeof this._token||0===this._token.trim().length)throw h("invalid api token provided: %o (%o)",this._token,typeof this._token),new o(`A valid API token is required when using the api-token auth strategy. Got "${this._token}"`);h("provider configuration validated successfully")}authenticate(){return h("no authentication step is required for the %o auth strategy, skipping",this.name),Promise.resolve()}get headers(){return{Authorization:`Bearer ${this._token}`}}}const m=t("strapi:auth:provider:users-permissions"),b="/auth/local";class w extends r{static identifier="users-permissions";_token=null;constructor(t){super(t)}get name(){return w.identifier}get _credentials(){return{identifier:this._options.identifier,password:this._options.password}}preflightValidation(){if(m("validating provider configuration"),void 0===this._options||null===this._options||"object"!=typeof this._options)throw m("invalid options provided: %s (%s)",this._options,typeof this._options),new o("Missing valid options for initializing the Users & Permissions auth provider.");const{identifier:t,password:e}=this._options;if("string"!=typeof t)throw m("invalid identifier provided: %s (%s)",t,typeof t),new o(`The "identifier" option must be a string, but got "${typeof t}"`);if("string"!=typeof e)throw m("invalid password provided: %s (%s)",e,typeof e),new o(`The "password" option must be a string, but got "${typeof e}"`);m("provider configuration validated successfully")}get headers(){return null===this._token?{}:{Authorization:`Bearer ${this._token}`}}async authenticate(t){const{identifier:e,password:r}=this._credentials;m("trying to authenticate with %o as %o at %o ",this.name,e,b);const n=await t.post(b,JSON.stringify({identifier:e,password:r}),{headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(n.statusText);const o=await n.json(),i=o.jwt.slice(0,5)+"..."+o.jwt.slice(-5);m("authentication successful for %o (%o)",e,i),this._token=o.jwt}}const v=t("strapi:auth:factory");class _{_registry=new Map;create(t,e){const r=this._registry.get(t);if(!r)throw v("the %o auth strategy is not registered, skipping",t),new n(`Auth strategy "${t}" is not supported.`);const o=r(e);return v("successfully instantiated a new %o provider",t),o}register(t,e){return this._registry.set(t,e),v("registered a new auth strategy: %o",t),this}}const S=t("strapi:auth:manager");class A{_authProviderFactory;_authProvider;_isAuthenticated=!1;constructor(t=new _){S("initializing a new auth manager"),this._authProviderFactory=t,this.registerDefaultProviders()}get strategy(){return this._authProvider?.name}get isAuthenticated(){return this._isAuthenticated}handleUnauthorizedError(){S("unauthorized error encountered, resetting authentication status"),this._isAuthenticated=!1}setStrategy(t,e){S("setting strategy to %o",t),this._authProvider=this._authProviderFactory.create(t,e)}async authenticate(t){if(void 0===this._authProvider)return S("no auth provider is set, skipping authentication"),void(this._isAuthenticated=!1);try{S("trying to authenticate with %s",this._authProvider.name);const e=t.create(void 0,!1);await this._authProvider.authenticate(e),this._isAuthenticated=!0,S("authentication successful")}catch(t){S(`authentication failed: ${t}`),this._isAuthenticated=!1}}authenticateRequest(t){if(!this._authProvider)return;const{headers:e}=t;if(!(e instanceof Headers))throw new Error(`Invalid request headers, headers must be an instance of Headers but found "${typeof e}"`);for(const[t,r]of Object.entries(this._authProvider.headers))e.set(t,r)}registerDefaultProviders(){S("registering default authentication providers"),this._authProviderFactory.register(g.identifier,(t=>new g(t))).register(w.identifier,(t=>new w(t))),S("default authentication providers registered successfully")}}var E,O,P,j,R,T,x,I,D,U,N,F,k,L,C,M,$,B,q,H,W,z,V,Q,K,G,J,Z,Y,X,tt,et,rt,nt,ot,it,at,st,ut,ct,lt,pt,ft,yt,dt,ht,gt,mt,bt,wt,vt,_t,St,At,Et,Ot,Pt,jt,Rt,Tt,xt,It,Dt,Ut,Nt,Ft,kt,Lt,Ct,Mt,$t,Bt,qt,Ht,Wt,zt,Vt,Qt,Kt,Gt,Jt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Zt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Yt(){return O?E:(O=1,E=TypeError)}function Xt(){return j?P:(j=1,P=e.inspect)}function te(){if(T)return R;T=1;var t="function"==typeof Map&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=t&&e&&"function"==typeof e.get?e.get:null,n=t&&Map.prototype.forEach,o="function"==typeof Set&&Set.prototype,i=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=o&&i&&"function"==typeof i.get?i.get:null,s=o&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,c="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,l="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,f=Object.prototype.toString,y=Function.prototype.toString,d=String.prototype.match,h=String.prototype.slice,g=String.prototype.replace,m=String.prototype.toUpperCase,b=String.prototype.toLowerCase,w=RegExp.prototype.test,v=Array.prototype.concat,_=Array.prototype.join,S=Array.prototype.slice,A=Math.floor,E="function"==typeof BigInt?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,j="function"==typeof Symbol&&"object"==typeof Symbol.iterator,x="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===j||"symbol")?Symbol.toStringTag:null,I=Object.prototype.propertyIsEnumerable,D=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function U(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||w.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var n=t<0?-A(-t):A(t);if(n!==t){var o=String(n),i=h.call(e,o.length+1);return g.call(o,r,"$&_")+"."+g.call(g.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return g.call(e,r,"$&_")}var N=Xt(),F=N.custom,k=H(F)?F:null,L={__proto__:null,double:'"',single:"'"},C={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function M(t,e,r){var n=r.quoteStyle||e,o=L[n];return o+t+o}function $(t){return g.call(String(t),/"/g,"&quot;")}function B(t){return!("[object Array]"!==V(t)||x&&"object"==typeof t&&x in t)}function q(t){return!("[object RegExp]"!==V(t)||x&&"object"==typeof t&&x in t)}function H(t){if(j)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!P)return!1;try{return P.call(t),!0}catch(t){}return!1}R=function t(e,o,i,f){var m=o||{};if(z(m,"quoteStyle")&&!z(L,m.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(m,"maxStringLength")&&("number"==typeof m.maxStringLength?m.maxStringLength<0&&m.maxStringLength!==1/0:null!==m.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var w=!z(m,"customInspect")||m.customInspect;if("boolean"!=typeof w&&"symbol"!==w)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(m,"indent")&&null!==m.indent&&"\t"!==m.indent&&!(parseInt(m.indent,10)===m.indent&&m.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(m,"numericSeparator")&&"boolean"!=typeof m.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var A=m.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return K(e,m);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var O=String(e);return A?U(e,O):O}if("bigint"==typeof e){var R=String(e)+"n";return A?U(e,R):R}var T=void 0===m.depth?5:m.depth;if(void 0===i&&(i=0),i>=T&&T>0&&"object"==typeof e)return B(e)?"[Array]":"[Object]";var F=function(t,e){var r;if("\t"===t.indent)r="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;r=_.call(Array(t.indent+1)," ")}return{base:r,prev:_.call(Array(e+1),r)}}(m,i);if(void 0===f)f=[];else if(Q(f,e)>=0)return"[Circular]";function C(e,r,n){if(r&&(f=S.call(f)).push(r),n){var o={depth:m.depth};return z(m,"quoteStyle")&&(o.quoteStyle=m.quoteStyle),t(e,o,i+1,f)}return t(e,m,i+1,f)}if("function"==typeof e&&!q(e)){var W=function(t){if(t.name)return t.name;var e=d.call(y.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),G=tt(e,C);return"[Function"+(W?": "+W:" (anonymous)")+"]"+(G.length>0?" { "+_.call(G,", ")+" }":"")}if(H(e)){var et=j?g.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):P.call(e);return"object"!=typeof e||j?et:J(et)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var rt="<"+b.call(String(e.nodeName)),nt=e.attributes||[],ot=0;ot<nt.length;ot++)rt+=" "+nt[ot].name+"="+M($(nt[ot].value),"double",m);return rt+=">",e.childNodes&&e.childNodes.length&&(rt+="..."),rt+="</"+b.call(String(e.nodeName))+">"}if(B(e)){if(0===e.length)return"[]";var it=tt(e,C);return F&&!function(t){for(var e=0;e<t.length;e++)if(Q(t[e],"\n")>=0)return!1;return!0}(it)?"["+X(it,F)+"]":"[ "+_.call(it,", ")+" ]"}if(function(t){return!("[object Error]"!==V(t)||x&&"object"==typeof t&&x in t)}(e)){var at=tt(e,C);return"cause"in Error.prototype||!("cause"in e)||I.call(e,"cause")?0===at.length?"["+String(e)+"]":"{ ["+String(e)+"] "+_.call(at,", ")+" }":"{ ["+String(e)+"] "+_.call(v.call("[cause]: "+C(e.cause),at),", ")+" }"}if("object"==typeof e&&w){if(k&&"function"==typeof e[k]&&N)return N(e,{depth:T-i});if("symbol"!==w&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!r||!t||"object"!=typeof t)return!1;try{r.call(t);try{a.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var st=[];return n&&n.call(e,(function(t,r){st.push(C(r,e,!0)+" => "+C(t,e))})),Y("Map",r.call(e),st,F)}if(function(t){if(!a||!t||"object"!=typeof t)return!1;try{a.call(t);try{r.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var ut=[];return s&&s.call(e,(function(t){ut.push(C(t,e))})),Y("Set",a.call(e),ut,F)}if(function(t){if(!u||!t||"object"!=typeof t)return!1;try{u.call(t,u);try{c.call(t,c)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return Z("WeakMap");if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t,c);try{u.call(t,u)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return Z("WeakSet");if(function(t){if(!l||!t||"object"!=typeof t)return!1;try{return l.call(t),!0}catch(t){}return!1}(e))return Z("WeakRef");if(function(t){return!("[object Number]"!==V(t)||x&&"object"==typeof t&&x in t)}(e))return J(C(Number(e)));if(function(t){if(!t||"object"!=typeof t||!E)return!1;try{return E.call(t),!0}catch(t){}return!1}(e))return J(C(E.call(e)));if(function(t){return!("[object Boolean]"!==V(t)||x&&"object"==typeof t&&x in t)}(e))return J(p.call(e));if(function(t){return!("[object String]"!==V(t)||x&&"object"==typeof t&&x in t)}(e))return J(C(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&e===globalThis||void 0!==Jt&&e===Jt)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==V(t)||x&&"object"==typeof t&&x in t)}(e)&&!q(e)){var ct=tt(e,C),lt=D?D(e)===Object.prototype:e instanceof Object||e.constructor===Object,pt=e instanceof Object?"":"null prototype",ft=!lt&&x&&Object(e)===e&&x in e?h.call(V(e),8,-1):pt?"Object":"",yt=(lt||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(ft||pt?"["+_.call(v.call([],ft||[],pt||[]),": ")+"] ":"");return 0===ct.length?yt+"{}":F?yt+"{"+X(ct,F)+"}":yt+"{ "+_.call(ct,", ")+" }"}return String(e)};var W=Object.prototype.hasOwnProperty||function(t){return t in this};function z(t,e){return W.call(t,e)}function V(t){return f.call(t)}function Q(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function K(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return K(h.call(t,0,e.maxStringLength),e)+n}var o=C[e.quoteStyle||"single"];return o.lastIndex=0,M(g.call(g.call(t,o,"\\$1"),/[\x00-\x1f]/g,G),"single",e)}function G(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+m.call(e.toString(16))}function J(t){return"Object("+t+")"}function Z(t){return t+" { ? }"}function Y(t,e,r,n){return t+" ("+e+") {"+(n?X(r,n):_.call(r,", "))+"}"}function X(t,e){if(0===t.length)return"";var r="\n"+e.prev+e.base;return r+_.call(t,","+r)+"\n"+e.prev}function tt(t,e){var r=B(t),n=[];if(r){n.length=t.length;for(var o=0;o<t.length;o++)n[o]=z(t,o)?e(t[o],t):""}var i,a="function"==typeof O?O(t):[];if(j){i={};for(var s=0;s<a.length;s++)i["$"+a[s]]=a[s]}for(var u in t)z(t,u)&&(r&&String(Number(u))===u&&u<t.length||j&&i["$"+u]instanceof Symbol||(w.call(/[^\w$]/,u)?n.push(e(u,t)+": "+e(t[u],t)):n.push(u+": "+e(t[u],t))));if("function"==typeof O)for(var c=0;c<a.length;c++)I.call(t,a[c])&&n.push("["+e(a[c])+"]: "+e(t[a[c]],t));return n}return R}function ee(){if(I)return x;I=1;var t=te(),e=Yt(),r=function(t,e,r){for(var n,o=t;null!=(n=o.next);o=n)if(n.key===e)return o.next=n.next,r||(n.next=t.next,t.next=n),n};return x=function(){var n,o={assert:function(r){if(!o.has(r))throw new e("Side channel does not contain "+t(r))},delete:function(t){var e=n&&n.next,o=function(t,e){if(t)return r(t,e,!0)}(n,t);return o&&e&&e===o&&(n=void 0),!!o},get:function(t){return function(t,e){if(t){var n=r(t,e);return n&&n.value}}(n,t)},has:function(t){return function(t,e){return!!t&&!!r(t,e)}(n,t)},set:function(t,e){n||(n={next:void 0}),function(t,e,n){var o=r(t,e);o?o.value=n:t.next={key:e,next:t.next,value:n}}(n,t,e)}};return o}}function re(){return U?D:(U=1,D=Object)}function ne(){return F?N:(F=1,N=Error)}function oe(){return L?k:(L=1,k=EvalError)}function ie(){return M?C:(M=1,C=RangeError)}function ae(){return B?$:(B=1,$=ReferenceError)}function se(){return H?q:(H=1,q=SyntaxError)}function ue(){return z?W:(z=1,W=URIError)}function ce(){return Q?V:(Q=1,V=Math.abs)}function le(){return G?K:(G=1,K=Math.floor)}function pe(){return Z?J:(Z=1,J=Math.max)}function fe(){return X?Y:(X=1,Y=Math.min)}function ye(){return et?tt:(et=1,tt=Math.pow)}function de(){return nt?rt:(nt=1,rt=Object.getOwnPropertyDescriptor)}function he(){if(it)return ot;it=1;var t=de();if(t)try{t([],"length")}catch(e){t=null}return ot=t}function ge(){if(st)return at;st=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}return at=t}function me(){if(pt)return lt;pt=1;var t="undefined"!=typeof Symbol&&Symbol,e=ct?ut:(ct=1,ut=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(var n in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var o=Object.getOwnPropertySymbols(t);if(1!==o.length||o[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0});return lt=function(){return"function"==typeof t&&("function"==typeof Symbol&&("symbol"==typeof t("foo")&&("symbol"==typeof Symbol("bar")&&e())))}}function be(){if(yt)return ft;yt=1;var t=Object.prototype.toString,e=Math.max,r=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var o=0;o<e.length;o+=1)r[o+t.length]=e[o];return r};return ft=function(n){var o=this;if("function"!=typeof o||"[object Function]"!==t.apply(o))throw new TypeError("Function.prototype.bind called on incompatible "+o);for(var i,a=function(t,e){for(var r=[],n=e,o=0;n<t.length;n+=1,o+=1)r[o]=t[n];return r}(arguments,1),s=e(0,o.length-a.length),u=[],c=0;c<s;c++)u[c]="$"+c;if(i=Function("binder","return function ("+function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=e);return r}(u,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var t=o.apply(this,r(a,arguments));return Object(t)===t?t:this}return o.apply(n,r(a,arguments))})),o.prototype){var l=function(){};l.prototype=o.prototype,i.prototype=new l,l.prototype=null}return i},ft}function we(){if(ht)return dt;ht=1;var t=be();return dt=Function.prototype.bind||t}function ve(){return mt?gt:(mt=1,gt=Function.prototype.call)}function _e(){return wt?bt:(wt=1,bt=Function.prototype.apply)}function Se(){if(At)return St;At=1;var t=we(),e=_e(),r=ve(),n=_t?vt:(_t=1,vt="undefined"!=typeof Reflect&&Reflect&&Reflect.apply);return St=n||t.call(r,e)}function Ae(){if(Ot)return Et;Ot=1;var t=we(),e=Yt(),r=ve(),n=Se();return Et=function(o){if(o.length<1||"function"!=typeof o[0])throw new e("a function is required");return n(t,r,o)}}function Ee(){if(jt)return Pt;jt=1;var t,e=Ae(),r=he();try{t=[].__proto__===Array.prototype}catch(t){if(!t||"object"!=typeof t||!("code"in t)||"ERR_PROTO_ACCESS"!==t.code)throw t}var n=!!t&&r&&r(Object.prototype,"__proto__"),o=Object,i=o.getPrototypeOf;return Pt=n&&"function"==typeof n.get?e([n.get]):"function"==typeof i&&function(t){return i(null==t?t:o(t))}}function Oe(){if(Tt)return Rt;Tt=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=we();return Rt=r.call(t,e)}function Pe(){if(It)return xt;var t;It=1;var e=re(),r=ne(),n=oe(),o=ie(),i=ae(),a=se(),s=Yt(),u=ue(),c=ce(),l=le(),p=pe(),f=fe(),y=ye(),d=Function,h=function(t){try{return d('"use strict"; return ('+t+").constructor;")()}catch(t){}},g=he(),m=ge(),b=function(){throw new s},w=g?function(){try{return b}catch(t){try{return g(arguments,"callee").get}catch(t){return b}}}():b,v=me()(),_=Ee(),S="function"==typeof Reflect&&Reflect.getPrototypeOf||e.getPrototypeOf||_,A=_e(),E=ve(),O={},P="undefined"!=typeof Uint8Array&&S?S(Uint8Array):t,j={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?t:ArrayBuffer,"%ArrayIteratorPrototype%":v&&S?S([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":O,"%AsyncGenerator%":O,"%AsyncGeneratorFunction%":O,"%AsyncIteratorPrototype%":O,"%Atomics%":"undefined"==typeof Atomics?t:Atomics,"%BigInt%":"undefined"==typeof BigInt?t:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?t:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float32Array%":"undefined"==typeof Float32Array?t:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?t:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?t:FinalizationRegistry,"%Function%":d,"%GeneratorFunction%":O,"%Int8Array%":"undefined"==typeof Int8Array?t:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?t:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":v&&S?S(S([][Symbol.iterator]())):t,"%JSON%":"object"==typeof JSON?JSON:t,"%Map%":"undefined"==typeof Map?t:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&v&&S?S((new Map)[Symbol.iterator]()):t,"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":g,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?t:Promise,"%Proxy%":"undefined"==typeof Proxy?t:Proxy,"%RangeError%":o,"%ReferenceError%":i,"%Reflect%":"undefined"==typeof Reflect?t:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?t:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&v&&S?S((new Set)[Symbol.iterator]()):t,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":v&&S?S(""[Symbol.iterator]()):t,"%Symbol%":v?Symbol:t,"%SyntaxError%":a,"%ThrowTypeError%":w,"%TypedArray%":P,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?t:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?t:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?t:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?t:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?t:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?t:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?t:WeakSet,"%Function.prototype.call%":E,"%Function.prototype.apply%":A,"%Object.defineProperty%":m,"%Math.abs%":c,"%Math.floor%":l,"%Math.max%":p,"%Math.min%":f,"%Math.pow%":y};if(S)try{null.error}catch(t){var R=S(S(t));j["%Error.prototype%"]=R}var T=function t(e){var r;if("%AsyncFunction%"===e)r=h("async function () {}");else if("%GeneratorFunction%"===e)r=h("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=h("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var o=t("%AsyncGenerator%");o&&S&&(r=S(o.prototype))}return j[e]=r,r},x={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},I=we(),D=Oe(),U=I.call(E,Array.prototype.concat),N=I.call(A,Array.prototype.splice),F=I.call(E,String.prototype.replace),k=I.call(E,String.prototype.slice),L=I.call(E,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,M=/\\(\\)?/g,$=function(t,e){var r,n=t;if(D(x,n)&&(n="%"+(r=x[n])[0]+"%"),D(j,n)){var o=j[n];if(o===O&&(o=T(n)),void 0===o&&!e)throw new s("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new a("intrinsic "+t+" does not exist!")};return xt=function(t,e){if("string"!=typeof t||0===t.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new s('"allowMissing" argument must be a boolean');if(null===L(/^%?[^%]*%?$/,t))throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(t){var e=k(t,0,1),r=k(t,-1);if("%"===e&&"%"!==r)throw new a("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new a("invalid intrinsic syntax, expected opening `%`");var n=[];return F(t,C,(function(t,e,r,o){n[n.length]=r?F(o,M,"$1"):e||t})),n}(t),n=r.length>0?r[0]:"",o=$("%"+n+"%",e),i=o.name,u=o.value,c=!1,l=o.alias;l&&(n=l[0],N(r,U([0,1],l)));for(var p=1,f=!0;p<r.length;p+=1){var y=r[p],d=k(y,0,1),h=k(y,-1);if(('"'===d||"'"===d||"`"===d||'"'===h||"'"===h||"`"===h)&&d!==h)throw new a("property names with quotes must have matching quotes");if("constructor"!==y&&f||(c=!0),D(j,i="%"+(n+="."+y)+"%"))u=j[i];else if(null!=u){if(!(y in u)){if(!e)throw new s("base intrinsic for "+t+" exists, but the property is not available.");return}if(g&&p+1>=r.length){var m=g(u,y);u=(f=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:u[y]}else f=D(u,y),u=u[y];f&&!c&&(j[i]=u)}}return u},xt}function je(){if(Ut)return Dt;Ut=1;var t=Pe(),e=Ae(),r=e([t("%String.prototype.indexOf%")]);return Dt=function(n,o){var i=t(n,!!o);return"function"==typeof i&&r(n,".prototype.")>-1?e([i]):i}}function Re(){if(Ft)return Nt;Ft=1;var t=Pe(),e=je(),r=te(),n=Yt(),o=t("%Map%",!0),i=e("Map.prototype.get",!0),a=e("Map.prototype.set",!0),s=e("Map.prototype.has",!0),u=e("Map.prototype.delete",!0),c=e("Map.prototype.size",!0);return Nt=!!o&&function(){var t,e={assert:function(t){if(!e.has(t))throw new n("Side channel does not contain "+r(t))},delete:function(e){if(t){var r=u(t,e);return 0===c(t)&&(t=void 0),r}return!1},get:function(e){if(t)return i(t,e)},has:function(e){return!!t&&s(t,e)},set:function(e,r){t||(t=new o),a(t,e,r)}};return e}}function Te(){if(Mt)return Ct;Mt=1;var t=Yt(),e=te(),r=ee(),n=Re(),o=function(){if(Lt)return kt;Lt=1;var t=Pe(),e=je(),r=te(),n=Re(),o=Yt(),i=t("%WeakMap%",!0),a=e("WeakMap.prototype.get",!0),s=e("WeakMap.prototype.set",!0),u=e("WeakMap.prototype.has",!0),c=e("WeakMap.prototype.delete",!0);return kt=i?function(){var t,e,l={assert:function(t){if(!l.has(t))throw new o("Side channel does not contain "+r(t))},delete:function(r){if(i&&r&&("object"==typeof r||"function"==typeof r)){if(t)return c(t,r)}else if(n&&e)return e.delete(r);return!1},get:function(r){return i&&r&&("object"==typeof r||"function"==typeof r)&&t?a(t,r):e&&e.get(r)},has:function(r){return i&&r&&("object"==typeof r||"function"==typeof r)&&t?u(t,r):!!e&&e.has(r)},set:function(r,o){i&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new i),s(t,r,o)):n&&(e||(e=n()),e.set(r,o))}};return l}:n}(),i=o||n||r;return Ct=function(){var r,n={assert:function(r){if(!n.has(r))throw new t("Side channel does not contain "+e(r))},delete:function(t){return!!r&&r.delete(t)},get:function(t){return r&&r.get(t)},has:function(t){return!!r&&r.has(t)},set:function(t,e){r||(r=i()),r.set(t,e)}};return n}}function xe(){if(Bt)return $t;Bt=1;var t=String.prototype.replace,e=/%20/g,r="RFC3986";return $t={default:r,formatters:{RFC1738:function(r){return t.call(r,e,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:r}}function Ie(){if(Ht)return qt;Ht=1;var t=xe(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),o=function(t,e){for(var r=e&&e.plainObjects?{__proto__:null}:{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r},i=1024;return qt={arrayToObject:o,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],o=0;o<e.length;++o)for(var i=e[o],a=i.obj[i.prop],s=Object.keys(a),u=0;u<s.length;++u){var c=s[u],l=a[c];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(e.push({obj:a,prop:c}),n.push(l))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(r(n)){for(var o=[],i=0;i<n.length;++i)void 0!==n[i]&&o.push(n[i]);e.obj[e.prop]=o}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(e,r,o,a,s){if(0===e.length)return e;var u=e;if("symbol"==typeof e?u=Symbol.prototype.toString.call(e):"string"!=typeof e&&(u=String(e)),"iso-8859-1"===o)return escape(u).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var c="",l=0;l<u.length;l+=i){for(var p=u.length>=i?u.slice(l,l+i):u,f=[],y=0;y<p.length;++y){var d=p.charCodeAt(y);45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===t.RFC1738&&(40===d||41===d)?f[f.length]=p.charAt(y):d<128?f[f.length]=n[d]:d<2048?f[f.length]=n[192|d>>6]+n[128|63&d]:d<55296||d>=57344?f[f.length]=n[224|d>>12]+n[128|d>>6&63]+n[128|63&d]:(y+=1,d=65536+((1023&d)<<10|1023&p.charCodeAt(y)),f[f.length]=n[240|d>>18]+n[128|d>>12&63]+n[128|d>>6&63]+n[128|63&d])}c+=f.join("")}return c},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(r(t)){for(var n=[],o=0;o<t.length;o+=1)n.push(e(t[o]));return n}return e(t)},merge:function t(n,i,a){if(!i)return n;if("object"!=typeof i&&"function"!=typeof i){if(r(n))n.push(i);else{if(!n||"object"!=typeof n)return[n,i];(a&&(a.plainObjects||a.allowPrototypes)||!e.call(Object.prototype,i))&&(n[i]=!0)}return n}if(!n||"object"!=typeof n)return[n].concat(i);var s=n;return r(n)&&!r(i)&&(s=o(n,a)),r(n)&&r(i)?(i.forEach((function(r,o){if(e.call(n,o)){var i=n[o];i&&"object"==typeof i&&r&&"object"==typeof r?n[o]=t(i,r,a):n.push(r)}else n[o]=r})),n):Object.keys(i).reduce((function(r,n){var o=i[n];return e.call(r,n)?r[n]=t(r[n],o,a):r[n]=o,r}),s)}},qt}function De(){if(zt)return Wt;zt=1;var t=Te(),e=Ie(),r=xe(),n=Object.prototype.hasOwnProperty,o={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},i=Array.isArray,a=Array.prototype.push,s=function(t,e){a.apply(t,i(e)?e:[e])},u=Date.prototype.toISOString,c=r.default,l={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:c,formatter:r.formatters[c],indices:!1,serializeDate:function(t){return u.call(t)},skipNulls:!1,strictNullHandling:!1},p={},f=function r(n,o,a,u,c,f,y,d,h,g,m,b,w,v,_,S,A,E){for(var O,P=n,j=E,R=0,T=!1;void 0!==(j=j.get(p))&&!T;){var x=j.get(n);if(R+=1,void 0!==x){if(x===R)throw new RangeError("Cyclic object value");T=!0}void 0===j.get(p)&&(R=0)}if("function"==typeof g?P=g(o,P):P instanceof Date?P=w(P):"comma"===a&&i(P)&&(P=e.maybeMap(P,(function(t){return t instanceof Date?w(t):t}))),null===P){if(f)return h&&!S?h(o,l.encoder,A,"key",v):o;P=""}if("string"==typeof(O=P)||"number"==typeof O||"boolean"==typeof O||"symbol"==typeof O||"bigint"==typeof O||e.isBuffer(P))return h?[_(S?o:h(o,l.encoder,A,"key",v))+"="+_(h(P,l.encoder,A,"value",v))]:[_(o)+"="+_(String(P))];var I,D=[];if(void 0===P)return D;if("comma"===a&&i(P))S&&h&&(P=e.maybeMap(P,h)),I=[{value:P.length>0?P.join(",")||null:void 0}];else if(i(g))I=g;else{var U=Object.keys(P);I=m?U.sort(m):U}var N=d?String(o).replace(/\./g,"%2E"):String(o),F=u&&i(P)&&1===P.length?N+"[]":N;if(c&&i(P)&&0===P.length)return F+"[]";for(var k=0;k<I.length;++k){var L=I[k],C="object"==typeof L&&L&&void 0!==L.value?L.value:P[L];if(!y||null!==C){var M=b&&d?String(L).replace(/\./g,"%2E"):String(L),$=i(P)?"function"==typeof a?a(F,M):F:F+(b?"."+M:"["+M+"]");E.set(n,R);var B=t();B.set(p,E),s(D,r(C,$,a,u,c,f,y,d,"comma"===a&&S&&i(P)?null:h,g,m,b,w,v,_,S,A,B))}}return D};return Wt=function(e,a){var u,c=e,p=function(t){if(!t)return l;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||l.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var a=r.default;if(void 0!==t.format){if(!n.call(r.formatters,t.format))throw new TypeError("Unknown format option provided.");a=t.format}var s,u=r.formatters[a],c=l.filter;if(("function"==typeof t.filter||i(t.filter))&&(c=t.filter),s=t.arrayFormat in o?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":l.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var p=void 0===t.allowDots?!0===t.encodeDotInKeys||l.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:l.addQueryPrefix,allowDots:p,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:l.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:l.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:void 0===t.delimiter?l.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:l.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:l.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:l.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:l.encodeValuesOnly,filter:c,format:a,formatter:u,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:l.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:l.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:l.strictNullHandling}}(a);"function"==typeof p.filter?c=(0,p.filter)("",c):i(p.filter)&&(u=p.filter);var y=[];if("object"!=typeof c||null===c)return"";var d=o[p.arrayFormat],h="comma"===d&&p.commaRoundTrip;u||(u=Object.keys(c)),p.sort&&u.sort(p.sort);for(var g=t(),m=0;m<u.length;++m){var b=u[m],w=c[b];p.skipNulls&&null===w||s(y,f(w,b,d,h,p.allowEmptyArrays,p.strictNullHandling,p.skipNulls,p.encodeDotInKeys,p.encode?p.encoder:null,p.filter,p.sort,p.allowDots,p.serializeDate,p.format,p.formatter,p.encodeValuesOnly,p.charset,g))}var v=y.join(p.delimiter),_=!0===p.addQueryPrefix?"?":"";return p.charsetSentinel&&("iso-8859-1"===p.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),v.length>0?_+v:""},Wt}function Ue(){if(Qt)return Vt;Qt=1;var t=Ie(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},o=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},i=function(t,e,r){if(t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1)return t.split(",");if(e.throwOnLimitExceeded&&r>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(1===e.arrayLimit?"":"s")+" allowed in an array.");return t},a=function(r,n,o,a){if(r){var s=o.allowDots?r.replace(/\.([^.[]+)/g,"[$1]"):r,u=/(\[[^[\]]*])/g,c=o.depth>0&&/(\[[^[\]]*])/.exec(s),l=c?s.slice(0,c.index):s,p=[];if(l){if(!o.plainObjects&&e.call(Object.prototype,l)&&!o.allowPrototypes)return;p.push(l)}for(var f=0;o.depth>0&&null!==(c=u.exec(s))&&f<o.depth;){if(f+=1,!o.plainObjects&&e.call(Object.prototype,c[1].slice(1,-1))&&!o.allowPrototypes)return;p.push(c[1])}if(c){if(!0===o.strictDepth)throw new RangeError("Input depth exceeded depth option of "+o.depth+" and strictDepth is true");p.push("["+s.slice(c.index)+"]")}return function(e,r,n,o){var a=0;if(e.length>0&&"[]"===e[e.length-1]){var s=e.slice(0,-1).join("");a=Array.isArray(r)&&r[s]?r[s].length:0}for(var u=o?r:i(r,n,a),c=e.length-1;c>=0;--c){var l,p=e[c];if("[]"===p&&n.parseArrays)l=n.allowEmptyArrays&&(""===u||n.strictNullHandling&&null===u)?[]:t.combine([],u);else{l=n.plainObjects?{__proto__:null}:{};var f="["===p.charAt(0)&&"]"===p.charAt(p.length-1)?p.slice(1,-1):p,y=n.decodeDotInKeys?f.replace(/%2E/g,"."):f,d=parseInt(y,10);n.parseArrays||""!==y?!isNaN(d)&&p!==y&&String(d)===y&&d>=0&&n.parseArrays&&d<=n.arrayLimit?(l=[])[d]=u:"__proto__"!==y&&(l[y]=u):l={0:u}}u=l}return u}(p,n,o,a)}};return Vt=function(s,u){var c=function(e){if(!e)return n;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0!==e.throwOnLimitExceeded&&"boolean"!=typeof e.throwOnLimitExceeded)throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var r=void 0===e.charset?n.charset:e.charset,o=void 0===e.duplicates?n.duplicates:e.duplicates;if("combine"!==o&&"first"!==o&&"last"!==o)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||n.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:n.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:n.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:n.arrayLimit,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:n.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:n.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:n.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:n.decoder,delimiter:"string"==typeof e.delimiter||t.isRegExp(e.delimiter)?e.delimiter:n.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:n.depth,duplicates:o,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:n.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:n.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:n.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:"boolean"==typeof e.throwOnLimitExceeded&&e.throwOnLimitExceeded}}(u);if(""===s||null==s)return c.plainObjects?{__proto__:null}:{};for(var l="string"==typeof s?function(a,s){var u={__proto__:null},c=s.ignoreQueryPrefix?a.replace(/^\?/,""):a;c=c.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var l=s.parameterLimit===1/0?void 0:s.parameterLimit,p=c.split(s.delimiter,s.throwOnLimitExceeded?l+1:l);if(s.throwOnLimitExceeded&&p.length>l)throw new RangeError("Parameter limit exceeded. Only "+l+" parameter"+(1===l?"":"s")+" allowed.");var f,y=-1,d=s.charset;if(s.charsetSentinel)for(f=0;f<p.length;++f)0===p[f].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[f]?d="utf-8":"utf8=%26%2310003%3B"===p[f]&&(d="iso-8859-1"),y=f,f=p.length);for(f=0;f<p.length;++f)if(f!==y){var h,g,m=p[f],b=m.indexOf("]="),w=-1===b?m.indexOf("="):b+1;-1===w?(h=s.decoder(m,n.decoder,d,"key"),g=s.strictNullHandling?null:""):(h=s.decoder(m.slice(0,w),n.decoder,d,"key"),g=t.maybeMap(i(m.slice(w+1),s,r(u[h])?u[h].length:0),(function(t){return s.decoder(t,n.decoder,d,"value")}))),g&&s.interpretNumericEntities&&"iso-8859-1"===d&&(g=o(String(g))),m.indexOf("[]=")>-1&&(g=r(g)?[g]:g);var v=e.call(u,h);v&&"combine"===s.duplicates?u[h]=t.combine(u[h],g):v&&"last"!==s.duplicates||(u[h]=g)}return u}(s,c):s,p=c.plainObjects?{__proto__:null}:{},f=Object.keys(l),y=0;y<f.length;++y){var d=f[y],h=a(d,l[d],c,"string"==typeof s);p=t.merge(p,h,c)}return!0===c.allowSparse?p:t.compact(p)}}function Ne(){if(Gt)return Kt;Gt=1;var t=De(),e=Ue();return Kt={formats:xe(),parse:e,stringify:t}}var Fe=Zt(Ne());const ke=t("strapi:utils:url-helper");class Le{static appendQueryParams(t,e){if(ke("appending query params to %o: %o",t,e),!e)return ke("no query params provided, returning original URL: %o",t),t;const r=Le.stringifyQueryParams(e);return r?URL.canParse(t)&&new URL(t).search?`${t}&${r}`:`${t}?${r}`:(ke("generated an empty query string, skipping..."),t)}static stringifyQueryParams(t){return Fe.stringify(t,{addQueryPrefix:!1,allowEmptyArrays:!0})}static toReadablePath(t){const e=t instanceof URL?t:new URL(t);return`${e.origin}${e.pathname}`}}class Ce{static format(t){if(!(t instanceof Request))throw new TypeError("Invalid input, expected a Request instance but found "+typeof t);return`${t.method} - ${Le.toReadablePath(t.url)}`}}class Me{_options;_httpClient;constructor(t,e){this._options=t,this._httpClient=e}get _resource(){return this._options.resource}get _path(){return this._options.path}get _pluginName(){return this._options.plugin?.name}get _pluginPrefix(){return void 0!==this._options.plugin?.prefix?this._options.plugin.prefix:this._pluginName?this._pluginName:void 0}get _rootPath(){if(this._path)return this._path;const t=this._pluginPrefix;return t?`/${t}/${this._resource}`:`/${this._resource}`}}const $e=t("strapi:ct:single");class Be extends Me{constructor(t,e){super(t,e),$e('initialized a new "single" manager with %o',t)}async find(t){$e("finding document for %o",this._resource);let e=this._rootPath;t&&(e=Le.appendQueryParams(e,t));const r=await this._httpClient.get(e);return $e("the %o document has been fetched",this._resource),r.json()}async update(t,e){$e("updating document for %o",this._resource);let r=this._rootPath;e&&(r=Le.appendQueryParams(r,e));const n=await this._httpClient.put(r,JSON.stringify({data:t}),{headers:{"Content-Type":"application/json"}});return $e("the %o document has been updated",this._resource),n.json()}async delete(t){$e("deleting document for %o",this._resource);let e=this._rootPath;t&&(e=Le.appendQueryParams(e,t)),await this._httpClient.delete(e),$e("the %o document has been deleted",this._resource)}}const qe=t("strapi:ct:collection"),He=["users-permissions"];class We extends Me{constructor(t,e){super(t,e),qe('initialized a new "collection" manager with %o',t)}shouldWrapDataBodyAttribute(){return!He.includes(this._pluginName??"")}async find(t){qe("finding documents for %o",this._resource);let e=this._rootPath;t&&(e=Le.appendQueryParams(e,t));const r=await this._httpClient.get(e),n=await r.json();return qe("found %o %o documents",Number(n?.data?.length),this._resource),n}async findOne(t,e){qe("finding a document for %o with id: %o",this._resource,t);let r=`${this._rootPath}/${t}`;e&&(r=Le.appendQueryParams(r,e));const n=await this._httpClient.get(r);return qe("found the %o document with document id %o",this._resource,t),n.json()}async create(t,e){qe("creating a document for %o",this._resource);let r=this._rootPath;e&&(r=Le.appendQueryParams(r,e));const n=await this._httpClient.post(r,JSON.stringify(this.shouldWrapDataBodyAttribute()?{data:t}:t),{headers:{"Content-Type":"application/json"}});return qe("created the %o document",this._resource),n.json()}async update(t,e,r){qe("updating a document for %o with id: %o",this._resource,t);let n=`${this._rootPath}/${t}`;r&&(n=Le.appendQueryParams(n,r));const o=await this._httpClient.put(n,JSON.stringify(this.shouldWrapDataBodyAttribute()?{data:e}:e),{headers:{"Content-Type":"application/json"}});return qe("updated the %o document with id %o",this._resource,t),o.json()}async delete(t,e){qe("deleting a document for %o with id: %o",this._resource,t);let r=`${this._rootPath}/${t}`;e&&(r=Le.appendQueryParams(r,e)),await this._httpClient.delete(r),qe("deleted the %o document with id %o",this._resource,t)}}class ze extends l{name="FileNotFoundError";fileId;constructor(t,e){super(e.response,e.request),this.fileId=t,this.message=`File with ID ${t} not found. The requested file may have been deleted or never existed.`}}class Ve extends y{name="FileForbiddenError";fileId;constructor(t,e){super(t.response,t.request),this.fileId=e,this.message=void 0!==e?`Access to file with ID ${e} is forbidden. You may not have sufficient permissions.`:"Access to files is forbidden. You may not have sufficient permissions."}}class Qe{static createMapper(t){return e=>e instanceof l?void 0!==t?new ze(t,e):e:e instanceof y?new Ve(e,t):e}}const Ke="/upload",Ge=t("strapi:files");class Je{_httpClient;constructor(t){this._httpClient=t,Ge("initialized files manager")}createFileHttpClient(t){const e=this._httpClient.create(),r=Qe.createMapper(t);return e.interceptors.response.use(void 0,(t=>{if(t instanceof Error)throw r(t);throw t})),e}async find(t){Ge("finding files");try{let e=`${Ke}/files`;t&&(e=Le.appendQueryParams(e,t));const r=this.createFileHttpClient(),n=await r.get(e),o=await n.json();return Ge("found %o files",Number(o?.length)),o}catch(t){throw Ge("error finding files: %o",t),t}}async findOne(t){Ge("finding file with ID %o",t);const e=`${Ke}/files/${t}`,r=this.createFileHttpClient(t);try{const n=await r.get(e),o=await n.json();return Ge("found file with ID %o",t),o}catch(e){throw Ge("error finding file with ID %o: %o",t,e),e}}async update(t,e){Ge("updating file with ID %o with data %o",t,e);try{const r=`${Ke}?id=${t}`,n=this.createFileHttpClient(t),o=new FormData;o.append("fileInfo",JSON.stringify(e));const i=await n.post(r,o),a=await i.json();return Ge("successfully updated file with ID %o",t),a}catch(e){throw Ge("error updating file with ID %o: %o",t,e),e}}async delete(t){Ge("deleting file with ID %o",t);try{const e=`${Ke}/files/${t}`,r=this.createFileHttpClient(t),n=await r.delete(e),o=await n.json();return Ge("successfully deleted file with ID %o",t),o}catch(e){throw Ge("error deleting file with ID %o: %o",t,e),e}}async upload(t,e){Ge("uploading new file");try{const r=Ke,n=this.createFileHttpClient();if("undefined"!=typeof Buffer&&Buffer.isBuffer(t)){if(!e||!("filename"in e)||!("mimetype"in e))throw new Error("Filename and mimetype are required when uploading Buffer data");return this.uploadBuffer(t,e,n,r)}return t instanceof Blob||console.warn("Could not determine type of file; attempting upload as Blob"),this.uploadBlob(t,e,n,r)}catch(t){throw Ge("error uploading file: %o",t),t}}async uploadBuffer(t,e,r,n){const o=new FormData,i=new Blob([t],{type:e.mimetype});o.append("files",i,e.filename),e.fileInfo&&o.append("fileInfo",JSON.stringify(e.fileInfo));const a=await r.post(n,o),s=await a.json();return Ge("successfully uploaded buffer file"),s}async uploadBlob(t,e,r,n){const o=new FormData;o.append("files",t),e?.fileInfo&&o.append("fileInfo",JSON.stringify(e.fileInfo));const i=await r.post(n,o),a=await i.json();return Ge("successfully uploaded blob file"),a}}const Ze={trailingSlashes:!1,leadingSlashes:!1};class Ye{static format(t,e=Ze){return t=Ye.formatTrailingSlashes(t,e.trailingSlashes),t=Ye.formatLeadingSlashes(t,e.leadingSlashes)}static formatTrailingSlashes(t,e=Ze.trailingSlashes){return"single"===e?Ye.ensureSingleTrailingSlash(t):e?t:Ye.removeTrailingSlashes(t)}static removeTrailingSlashes(t){return t.replace(/\/+$/,"")}static ensureSingleTrailingSlash(t){return`${this.removeTrailingSlashes(t)}/`}static formatLeadingSlashes(t,e=Ze.leadingSlashes){return"single"===e?Ye.ensureSingleLeadingSlash(t):e?t:Ye.removeLeadingSlashes(t)}static removeLeadingSlashes(t){return t.replace(/^\/+/,"")}static ensureSingleLeadingSlash(t){return`/${this.removeLeadingSlashes(t)}`}}const Xe=t("strapi:validators:url");class tr{validate(t){if("string"!=typeof t)throw Xe("url must be a string, received: %o (%s)",t,typeof t),new s(t);if(!this.canParse(t))throw Xe("url could not be parsed: %o (%s)",t,typeof t),new s(t);Xe("validated url successfully: %o",t)}canParse(t){return URL.canParse(t)}}const er=t("strapi:validators:config");class rr{_urlValidator;constructor(t=new tr){this._urlValidator=t}validateConfig(t){if(er("validating client config"),null==t||Array.isArray(t)||"object"!=typeof t)throw er("provided client configuration is not a valid object: %o (%s)",t,typeof t),new o(new TypeError("The provided configuration is not a valid object."));this.validateBaseURL(t.baseURL),this.validateHeaders(t.headers),er("validated client config successfully")}validateBaseURL(t){try{er("validating base url"),this._urlValidator.validate(t)}catch(e){if(e instanceof a)throw er("failed to validate client config, invalid base url %o",t),new o(e);throw e}}validateHeaders(t){if(er("validating headers"),void 0!==t){if(null===t||"object"!=typeof t||Array.isArray(t))throw er("invalid headers type: %o (%s)",t,typeof t),new o(new TypeError("Headers must be a valid object."));for(const[e,r]of Object.entries(t))if("string"!=typeof r)throw er("invalid header value for key %s: %o (%s)",e,r,typeof r),new o(new TypeError("Header values must be strings."));er("headers validated successfully")}}}var nr;!function(t){t[t.OK=200]="OK",t[t.CREATED=201]="CREATED",t[t.NO_CONTENT=204]="NO_CONTENT",t[t.BAD_REQUEST=400]="BAD_REQUEST",t[t.UNAUTHORIZED=401]="UNAUTHORIZED",t[t.FORBIDDEN=403]="FORBIDDEN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.TIMEOUT=408]="TIMEOUT",t[t.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"}(nr||(nr={}));class or{_handlers;constructor(t=[]){this._handlers=t}use(t,e){return this._handlers.push({fulfilled:t,rejected:e}),this}clone(){return new or([...this._handlers])}async execute(t){let e=t;for(const t of this._handlers)try{t.fulfilled&&(e=await t.fulfilled(e))}catch(r){if(!t.rejected)throw r;e=await t.rejected(r)}return e}async reject(t){let e=t;for(const t of this._handlers)t.rejected&&(e=await t.rejected(e));return e}}const ir=t("strapi:http");class ar{interceptors;_baseURL;_timeout;_headers;_urlValidator;constructor(t,e=new tr){ir("initializing new client with base url: %o",t.baseURL),this._baseURL=Ye.format(t.baseURL,{trailingSlashes:!1}),this._timeout=t.timeout??1e4,this._headers=t.headers??{},this.interceptors={request:new or,response:new or},this._urlValidator=e,this._urlValidator.validate(this._baseURL)}get baseURL(){return this._baseURL}get timeout(){return this._timeout}get headers(){return this._headers}setBaseURL(t){return this._urlValidator.validate(t),this._baseURL=Ye.format(t,{trailingSlashes:!1}),ir("setting new base url: %o",this._baseURL),this}setTimeout(t){if(ir("setting new timeout: %o",t),!Number.isSafeInteger(t))throw new TypeError("Timeout must be a safe integer");return this._timeout=t,this}async request(t,e){const r=Ye.format(t,{leadingSlashes:"single"}),n=new URL(`${this.baseURL}${r}`),o=new Request(n,e);for(const[t,e]of Object.entries(this._headers))o.headers.append(t,e),ir("%o header set to %o for %o",t,e,Ce.format(o));const{request:i}=await this.interceptors.request.execute({request:o}),a=new AbortController,s=setTimeout((()=>a.abort()),this._timeout),u=new Request(i,{signal:a.signal});try{const t=await this.fetch(u);clearTimeout(s);const{response:e}=await this.interceptors.response.execute({request:u,response:t});return e}catch(t){throw clearTimeout(s),await this.interceptors.response.reject(t)}}fetch(t,e){return globalThis.fetch(t,e)}async get(t,e){return this.request(t,{method:"GET",...e})}async post(t,e,r){return this.request(t,{method:"POST",body:e,...r})}async put(t,e,r){return this.request(t,{method:"PUT",body:e,...r})}async delete(t,e){return this.request(t,{method:"DELETE",...e})}create(t={},e=!0){const r=new(Object.getPrototypeOf(this).constructor)({baseURL:t.baseURL??this._baseURL,timeout:t.timeout??this._timeout,headers:t.headers??this._headers},this._urlValidator);if(!(r instanceof ar))throw new Error("The created instance is not an instance of HttpClient");return e&&(r.interceptors.request=this.interceptors.request.clone(),r.interceptors.response=this.interceptors.response.clone()),r}static mapResponseToHTTPError(t,e){switch(t.status){case nr.BAD_REQUEST:return new p(t,e);case nr.UNAUTHORIZED:return new c(t,e);case nr.FORBIDDEN:return new y(t,e);case nr.NOT_FOUND:return new l(t,e);case nr.TIMEOUT:return new d(t,e);case nr.INTERNAL_SERVER_ERROR:return new f(t,e)}return new u(t,e)}}class sr{static ensurePreAuthentication(t,e){return async({request:r})=>{const{strategy:n,isAuthenticated:o}=t;return n&&!o&&await t.authenticate(e),{request:r}}}static authenticateRequests(t){return({request:e})=>(t.authenticateRequest(e),{request:e})}static notifyOnUnauthorizedResponse(t){const e=()=>t.handleUnauthorizedError();return[({request:t,response:r})=>(!r.ok&&r.status===nr.UNAUTHORIZED&&e(),{request:t,response:r}),t=>(t instanceof c&&e(),t)]}}class ur{static setDefaultHeaders(){const t=new Map([["Content-Type","application/json"]]);return({request:e})=>{for(const[r,n]of t.entries()){if(!e.headers.has(r)){if("Content-Type"===r&&e.body instanceof FormData)continue;e.headers.set(r,n)}}return{request:e}}}static transformErrors(){return({request:t,response:e})=>{if(e.ok)return{request:t,response:e};throw ar.mapResponseToHTTPError(e,t)}}}const cr=t("strapi:core");class lr{_config;_validator;_authManager;_httpClient;files;constructor(t,e=new rr,r=new A,n){this._config=t,this._validator=e,this._authManager=r,cr("started the initialization process"),this.preflightValidation(),cr("user config passed the preflight validation"),this._httpClient=n?n({baseURL:t.baseURL,headers:t.headers}):new ar({baseURL:t.baseURL,headers:t.headers}),this.files=new Je(this._httpClient),this.init(),cr("finished the client initialization process")}preflightValidation(){try{cr("validating the configuration"),this._validator.validateConfig(this._config)}catch(t){throw new i(t)}}init(){cr("init modules"),this.initHttp(),this.initAuth()}initHttp(){cr("init http module"),this._httpClient.interceptors.request.use(ur.setDefaultHeaders()),this._httpClient.interceptors.response.use(ur.transformErrors())}initAuth(){if(cr("init auth module"),this.auth){const{strategy:t,options:e}=this.auth;cr("setting up the auth strategy using %o",t);try{this._authManager.setStrategy(t,e)}catch(t){throw new i(t,`Failed to initialize the client auth manager: ${t instanceof n?t.cause:t}`)}}this._httpClient.interceptors.request.use(sr.ensurePreAuthentication(this._authManager,this._httpClient)).use(sr.authenticateRequests(this._authManager)),this._httpClient.interceptors.response.use(...sr.notifyOnUnauthorizedResponse(this._authManager))}get auth(){return this._config.auth}get baseURL(){return this._config.baseURL}fetch(t,e){return this._httpClient.request(t,e)}collection(t,e={}){const{path:r,plugin:n}=e;return new We({resource:t,path:r,plugin:n},this._httpClient)}single(t,e={}){const{path:r}=e;return new Be({resource:t,path:r},this._httpClient)}}const pr=t=>{const{baseURL:e,auth:r,headers:n}=t,o={baseURL:e,headers:n};return void 0!==r&&(o.auth={strategy:g.identifier,options:{token:r}}),new lr(o)};export{c as HTTPAuthorizationError,p as HTTPBadRequestError,u as HTTPError,y as HTTPForbiddenError,f as HTTPInternalServerError,l as HTTPNotFoundError,d as HTTPTimeoutError,n as StrapiError,i as StrapiInitializationError,o as StrapiValidationError,s as URLParsingError,a as URLValidationError,pr as strapi};
