import {
  createApi,
  require_lib,
  require_pipe
} from "./chunk-MQTX2EPM.js";
import {
  createSlice
} from "./chunk-XIWU657M.js";
import {
  __toESM
} from "./chunk-PLDDJCW6.js";

// node_modules/@strapi/admin/dist/admin/admin/src/utils/cookies.mjs
var getCookieValue = (name) => {
  let result = null;
  const cookieArray = document.cookie.split(";");
  cookieArray.forEach((cookie) => {
    const [key, value] = cookie.split("=").map((item) => item.trim());
    if (key === name) {
      result = decodeURIComponent(value);
    }
  });
  return result;
};
var setCookie = (name, value, days) => {
  let expires = "";
  document.cookie = `${name}=${encodeURIComponent(value)}; Path=/${expires}`;
};
var deleteCookie = (name) => {
  document.cookie = `${name}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;`;
};

// node_modules/@strapi/admin/dist/admin/admin/src/reducer.mjs
var STORAGE_KEYS = {
  TOKEN: "jwtToken",
  STATUS: "isLoggedIn"
};
var THEME_LOCAL_STORAGE_KEY = "STRAPI_THEME";
var LANGUAGE_LOCAL_STORAGE_KEY = "strapi-admin-language";
var getStoredToken = () => {
  const fromLocalStorage = localStorage.getItem(STORAGE_KEYS.TOKEN);
  if (fromLocalStorage) {
    return JSON.parse(fromLocalStorage);
  }
  const fromCookie = getCookieValue(STORAGE_KEYS.TOKEN);
  return fromCookie ?? null;
};
var adminSlice = createSlice({
  name: "admin",
  initialState: () => {
    return {
      language: {
        locale: "en",
        localeNames: {
          en: "English"
        }
      },
      permissions: {},
      theme: {
        availableThemes: [],
        currentTheme: localStorage.getItem(THEME_LOCAL_STORAGE_KEY) || "system"
      },
      token: null
    };
  },
  reducers: {
    setAppTheme(state, action) {
      state.theme.currentTheme = action.payload;
      window.localStorage.setItem(THEME_LOCAL_STORAGE_KEY, action.payload);
    },
    setAvailableThemes(state, action) {
      state.theme.availableThemes = action.payload;
    },
    setLocale(state, action) {
      state.language.locale = action.payload;
      window.localStorage.setItem(LANGUAGE_LOCAL_STORAGE_KEY, action.payload);
      document.documentElement.setAttribute("lang", action.payload);
    },
    setToken(state, action) {
      state.token = action.payload;
    },
    login(state, action) {
      const { token, persist } = action.payload;
      if (!persist) {
        setCookie(STORAGE_KEYS.TOKEN, token);
      } else {
        window.localStorage.setItem(STORAGE_KEYS.TOKEN, JSON.stringify(token));
      }
      window.localStorage.setItem(STORAGE_KEYS.STATUS, "true");
      state.token = token;
    },
    logout(state) {
      state.token = null;
      deleteCookie(STORAGE_KEYS.TOKEN);
      window.localStorage.removeItem(STORAGE_KEYS.TOKEN);
      window.localStorage.removeItem(STORAGE_KEYS.STATUS);
    }
  }
});
var reducer = adminSlice.reducer;
var { setAppTheme, setAvailableThemes, setLocale, setToken, logout, login } = adminSlice.actions;

// node_modules/@strapi/admin/dist/admin/admin/src/utils/getFetchClient.mjs
var import_pipe = __toESM(require_pipe(), 1);
var import_qs = __toESM(require_lib(), 1);
var STORAGE_KEYS2 = {
  TOKEN: "jwtToken",
  USER: "userInfo"
};
var FetchError = class _FetchError extends Error {
  constructor(message, response) {
    var _a, _b, _c, _d;
    super(message);
    this.name = "FetchError";
    this.message = message;
    this.response = response;
    this.code = (_b = (_a = response == null ? void 0 : response.data) == null ? void 0 : _a.error) == null ? void 0 : _b.status;
    this.status = (_d = (_c = response == null ? void 0 : response.data) == null ? void 0 : _c.error) == null ? void 0 : _d.status;
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, _FetchError);
    }
  }
};
var isFetchError = (error) => {
  return error instanceof FetchError;
};
var getToken = () => {
  const fromLocalStorage = localStorage.getItem(STORAGE_KEYS2.TOKEN);
  if (fromLocalStorage) {
    return JSON.parse(fromLocalStorage);
  }
  const fromCookie = getCookieValue(STORAGE_KEYS2.TOKEN);
  return fromCookie ?? null;
};
var getFetchClient = (defaultOptions = {}) => {
  const backendURL = window.strapi.backendURL;
  const defaultHeader = {
    Accept: "application/json",
    "Content-Type": "application/json",
    Authorization: `Bearer ${getToken()}`
  };
  const isFormDataRequest = (body) => body instanceof FormData;
  const addPrependingSlash = (url) => url.charAt(0) !== "/" ? `/${url}` : url;
  const hasProtocol = (url) => new RegExp("^(?:[a-z+]+:)?//", "i").test(url);
  const normalizeUrl = (url) => hasProtocol(url) ? url : addPrependingSlash(url);
  const responseInterceptor = async (response, validateStatus) => {
    try {
      const result = await response.json();
      if (!response.ok && result.error && !(validateStatus == null ? void 0 : validateStatus(response.status))) {
        throw new FetchError(result.error.message, {
          data: result
        });
      }
      if (!response.ok && !(validateStatus == null ? void 0 : validateStatus(response.status))) {
        throw new FetchError("Unknown Server Error");
      }
      return {
        data: result
      };
    } catch (error) {
      if (error instanceof SyntaxError && response.ok) {
        return {
          data: [],
          status: response.status
        };
      } else {
        throw error;
      }
    }
  };
  const paramsSerializer = (params) => (url) => {
    if (params) {
      if (typeof params === "string") {
        return `${url}?${params}`;
      }
      const serializedParams = import_qs.default.stringify(params, {
        encode: false
      });
      return `${url}?${serializedParams}`;
    }
    return url;
  };
  const addBaseUrl = (url) => {
    return `${backendURL}${url}`;
  };
  const makeCreateRequestUrl = (options) => (0, import_pipe.default)(normalizeUrl, addBaseUrl, paramsSerializer(options == null ? void 0 : options.params));
  const fetchClient = {
    get: async (url, options) => {
      const headers = new Headers({
        ...defaultHeader,
        ...options == null ? void 0 : options.headers
      });
      const createRequestUrl = makeCreateRequestUrl(options);
      const response = await fetch(createRequestUrl(url), {
        signal: (options == null ? void 0 : options.signal) ?? defaultOptions.signal,
        method: "GET",
        headers
      });
      return responseInterceptor(response, options == null ? void 0 : options.validateStatus);
    },
    post: async (url, data, options) => {
      const headers = new Headers({
        ...defaultHeader,
        ...options == null ? void 0 : options.headers
      });
      const createRequestUrl = makeCreateRequestUrl(options);
      if (isFormDataRequest(data)) {
        headers.delete("Content-Type");
      }
      const response = await fetch(createRequestUrl(url), {
        signal: (options == null ? void 0 : options.signal) ?? defaultOptions.signal,
        method: "POST",
        headers,
        body: isFormDataRequest(data) ? data : JSON.stringify(data)
      });
      return responseInterceptor(response, options == null ? void 0 : options.validateStatus);
    },
    put: async (url, data, options) => {
      const headers = new Headers({
        ...defaultHeader,
        ...options == null ? void 0 : options.headers
      });
      const createRequestUrl = makeCreateRequestUrl(options);
      if (isFormDataRequest(data)) {
        headers.delete("Content-Type");
      }
      const response = await fetch(createRequestUrl(url), {
        signal: (options == null ? void 0 : options.signal) ?? defaultOptions.signal,
        method: "PUT",
        headers,
        body: isFormDataRequest(data) ? data : JSON.stringify(data)
      });
      return responseInterceptor(response, options == null ? void 0 : options.validateStatus);
    },
    del: async (url, options) => {
      const headers = new Headers({
        ...defaultHeader,
        ...options == null ? void 0 : options.headers
      });
      const createRequestUrl = makeCreateRequestUrl(options);
      const response = await fetch(createRequestUrl(url), {
        signal: (options == null ? void 0 : options.signal) ?? defaultOptions.signal,
        method: "DELETE",
        headers
      });
      return responseInterceptor(response, options == null ? void 0 : options.validateStatus);
    }
  };
  return fetchClient;
};

// node_modules/@strapi/admin/dist/admin/admin/src/utils/baseQuery.mjs
var refreshPromise = null;
var isAuthPath = (url) => /^\/admin\/(login|logout|access-token)\b/.test(url);
var simpleQuery = async (query, api) => {
  var _a, _b, _c, _d;
  const { signal, dispatch } = api;
  const executeQuery = async (queryToExecute) => {
    const { get, post, del, put } = getFetchClient();
    if (typeof queryToExecute === "string") {
      const result = await get(queryToExecute, {
        signal
      });
      return result;
    }
    const { url, method = "GET", data, config } = queryToExecute;
    if (method === "POST") {
      return post(url, data, {
        ...config,
        signal
      });
    }
    if (method === "DELETE") {
      return del(url, {
        ...config,
        signal
      });
    }
    if (method === "PUT") {
      return put(url, data, {
        ...config,
        signal
      });
    }
    return get(url, {
      ...config,
      signal
    });
  };
  try {
    const result = await executeQuery(query);
    return {
      data: result.data
    };
  } catch (err) {
    if (isFetchError(err)) {
      if (err.status === 401) {
        const url = typeof query === "string" ? query : query.url;
        if (!isAuthPath(url)) {
          if (!refreshPromise) {
            async function refreshAccessToken() {
              var _a2, _b2;
              const { post } = getFetchClient();
              const res = await post("/admin/access-token");
              const token = (_b2 = (_a2 = res == null ? void 0 : res.data) == null ? void 0 : _a2.data) == null ? void 0 : _b2.token;
              if (!token) {
                throw new Error("access_token_exchange_failed");
              }
              const persist = Boolean(localStorage.getItem("jwtToken"));
              dispatch(login({
                token,
                persist
              }));
              return token;
            }
            refreshPromise = refreshAccessToken().finally(() => {
              refreshPromise = null;
            });
          }
          try {
            await refreshPromise;
            const retry = await executeQuery(query);
            return {
              data: retry.data
            };
          } catch (refreshError) {
            try {
              const { post } = getFetchClient();
              await post("/admin/logout");
            } catch {
            }
            dispatch(logout());
          }
        }
      }
      if (typeof ((_a = err.response) == null ? void 0 : _a.data) === "object" && ((_b = err.response) == null ? void 0 : _b.data) !== null && "error" in ((_c = err.response) == null ? void 0 : _c.data)) {
        return {
          data: void 0,
          error: (_d = err.response) == null ? void 0 : _d.data.error
        };
      } else {
        return {
          data: void 0,
          error: {
            name: "UnknownError",
            message: err.message,
            details: err.response,
            status: err.status
          }
        };
      }
    }
    const error = err;
    return {
      data: void 0,
      error: {
        name: error.name,
        message: error.message,
        stack: error.stack
      }
    };
  }
};
var fetchBaseQuery = () => simpleQuery;
var isBaseQueryError = (error) => {
  return error.name !== void 0;
};

// node_modules/@strapi/admin/dist/admin/admin/src/services/api.mjs
var adminApi = createApi({
  reducerPath: "adminApi",
  baseQuery: fetchBaseQuery(),
  tagTypes: [
    "GuidedTourMeta",
    "HomepageKeyStatistics"
  ],
  endpoints: () => ({})
});

export {
  getCookieValue,
  THEME_LOCAL_STORAGE_KEY,
  LANGUAGE_LOCAL_STORAGE_KEY,
  getStoredToken,
  reducer,
  setAppTheme,
  setAvailableThemes,
  setLocale,
  logout,
  login,
  FetchError,
  isFetchError,
  getFetchClient,
  fetchBaseQuery,
  isBaseQueryError,
  adminApi
};
//# sourceMappingURL=chunk-3P6TVZEI.js.map
